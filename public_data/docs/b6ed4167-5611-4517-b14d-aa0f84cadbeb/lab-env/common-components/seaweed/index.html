<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>SeaweedFS - PrompGuard Technical Spec</title>
        <link href="../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../../css/brands.min.css" rel="stylesheet">
        <link href="../../../css/solid.min.css" rel="stylesheet">
        <link href="../../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../..">PrompGuard Technical Spec</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Lab Environment</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../intro/" class="dropdown-item">Introduction</a>
</li>
                                    
<li>
    <a href="../../hlds/" class="dropdown-item">High Level Design</a>
</li>
                                    
<li>
    <a href="../../txn-risk-score/" class="dropdown-item">Transaction Risk Score</a>
</li>
                                    
<li>
    <a href="../../data-prep/" class="dropdown-item">Data Preparation</a>
</li>
                                    
<li>
    <a href="../../model-eval/" class="dropdown-item">Model Evaluation Pipeline</a>
</li>
                                    
<li>
    <a href="../../model-train/" class="dropdown-item">Model Training Pipeline</a>
</li>
                                    
<li>
    <a href="../../version-ctrl/" class="dropdown-item">Fraud Engine Version Control</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Common Components</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../redis/" class="dropdown-item">Redis</a>
</li>
            
<li>
    <a href="../kafka/" class="dropdown-item">Kafka</a>
</li>
            
<li>
    <a href="./" class="dropdown-item active" aria-current="page">SeaweedFS</a>
</li>
            
<li>
    <a href="../postgres/" class="dropdown-item">Postgres</a>
</li>
            
<li>
    <a href="../airflow/" class="dropdown-item">Apache Airflow</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a href="../../../prod-env/" class="nav-link">Prod Environment</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../../api-std/" class="nav-link">API Standard</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../kafka/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../postgres/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item dropdown">
                              <button id="theme-menu" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme" class="nav-link dropdown-toggle">
                                <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                <span class="d-lg-none ms-2">Toggle theme</span>
                              </button>
                              <ul class="dropdown-menu dropdown-menu-end">
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="true">
                                    <i class="fa-solid fa-sun fa-fw"></i>
                                    <span class="ms-2">Light</span>
                                    <i class="fa-solid fa-check ms-auto"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                                    <i class="fa-solid fa-moon fa-fw"></i>
                                    <span class="ms-2">Dark</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="auto" aria-pressed="false">
                                    <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                    <span class="ms-2">Auto</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                              </ul>
                            </li>
                    </ul>
                </div>
            </div>
        </div>
        <script src="../../../js/darkmode.js"></script>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#seaweedfs" class="nav-link">SeaweedFS</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#architecture" class="nav-link">Architecture</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#sizing" class="nav-link">Sizing</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#config" class="nav-link">Config</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="seaweedfs">SeaweedFS</h1>
<p>Detail…</p>
<h1 id="architecture">Architecture</h1>
<p>…</p>
<h2 id="sizing">Sizing</h2>
<p>SeaweedFS simply stores the Parquet files as binary blobs. It does not add extra overhead and can actually provide additional storage efficiency if we enable Erasure Coding (EC) at the SeaweedFS level, as data retention policy.</p>
<p>The primary data kept in SeaweedFS are:  </p>
<ul>
<li>Raw PromptPay transaction (PII-safe)</li>
<li>CFR archival data (PII-safe)</li>
<li>Predicted results with their features</li>
<li>Transaction risk score</li>
<li>Account risk score</li>
<li>ML model repository</li>
<li>Master data, e.g., FI code, Bank Account</li>
<li>Data Analytics (Lab only)</li>
</ul>
<h3 id="summary-table">Summary Table</h3>
<table>
<thead>
<tr>
<th>Dataset</th>
<th style="text-align: right;">Estimated size (13-month retention)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Raw PromptPay transaction (PII-safe)</td>
<td style="text-align: right;">26 TB</td>
</tr>
<tr>
<td>CFR archival data (PII-safe)</td>
<td style="text-align: right;">400 GB</td>
</tr>
<tr>
<td>Predicted results with their features</td>
<td style="text-align: right;">28 TB</td>
</tr>
<tr>
<td>ML model repository</td>
<td style="text-align: right;">400 MB</td>
</tr>
<tr>
<td>Master data</td>
<td style="text-align: right;">1 GB</td>
</tr>
<tr>
<td>Backup Storage</td>
<td style="text-align: right;">140 GB</td>
</tr>
<tr>
<td>Data Analytics (Lab only)</td>
<td style="text-align: right;">60 TB</td>
</tr>
<tr>
<td><strong>Total</strong></td>
<td style="text-align: right;">~115 TB</td>
</tr>
</tbody>
</table>
<h3 id="base-estimation">Base Estimation</h3>
<p>Any data that kept in Parquet format will be compressed with <strong>Polars</strong> using the <strong>Zstd (Level 3)</strong> algorithm.<br />
Why?</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Snappy</th>
<th>Zstd (Level 3)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Write (CPU)</td>
<td>Blazing fast, low overhead</td>
<td>Moderate; tunable levels</td>
</tr>
<tr>
<td>Write (Network)</td>
<td>Slower due to larger file size</td>
<td>Faster due to ~39% smaller files</td>
</tr>
<tr>
<td>Decompression</td>
<td>~3.5 GB/s</td>
<td>~1.0 GB/s</td>
</tr>
<tr>
<td>Storage Cost</td>
<td>Higher (~70-80% raw compressed)</td>
<td>Significant savings (~80-90% raw compressed) <br> Claimed 30-40% saver compare with Snappy for Parquet files</td>
</tr>
</tbody>
</table>
<p>Verdict: In 2025, Zstd (level 3) is the superior default because its storage and network savings far outweigh the raw CPU speed advantage of Snappy.</p>
<p>From now on, we will use <strong>80% compression level</strong> for any Parquet storage sizing.</p>
<hr />
<p><strong>Raw PromptPay transaction (PII-safe)</strong><br />
Based on Jun 2024, table below shows transaction stats:</p>
<table>
<thead>
<tr>
<th>PP stats of monthly transaction</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Total account</td>
<td>83,962,241</td>
</tr>
<tr>
<td>Avg #of an account txn</td>
<td>31.54</td>
</tr>
<tr>
<td>Median</td>
<td>12</td>
</tr>
<tr>
<td>Max</td>
<td>374</td>
</tr>
</tbody>
</table>
<blockquote>
<p>⚠️ After cut top 1% outlier off.</p>
</blockquote>
<table>
<thead>
<tr>
<th>PP transaction storage sizing</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>A message size.<br>See: <a href="../../txn-risk-score/#promptpay-message-schema">schema</a>.</td>
<td>~750 bytes (raw JSON)</td>
</tr>
<tr>
<td>Expected TPS</td>
<td>5,000</td>
</tr>
<tr>
<td>Transactions per month</td>
<td>~13.18 billion</td>
</tr>
<tr>
<td>Retention</td>
<td>13 months</td>
</tr>
<tr>
<td>Raw size per month</td>
<td>~9.88 TB</td>
</tr>
<tr>
<td>Parquet size per month (Zstd)</td>
<td>~1.98 TB</td>
</tr>
<tr>
<td><strong>Total Parquet size (13 months)</strong></td>
<td><strong>~26 TB</strong></td>
</tr>
</tbody>
</table>
<p>ℹ️ A PromptPay transaction can be either Account Lookup or Credit transfer message.</p>
<table>
<thead>
<tr>
<th>CFR archival data (PII-safe)</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Today parquet dump size</td>
<td>25 GB</td>
</tr>
<tr>
<td>Growth rate</td>
<td>4% / month</td>
</tr>
<tr>
<td>Retention</td>
<td>6 months</td>
</tr>
<tr>
<td>5-year space require</td>
<td>~268 GB</td>
</tr>
<tr>
<td><strong>Total w headrtoom</strong></td>
<td><strong>400 GB</strong></td>
</tr>
</tbody>
</table>
<p><strong>Predicted results with their features</strong>  </p>
<table>
<thead>
<tr>
<th>Transaction risk score</th>
<th>Estimated value</th>
</tr>
</thead>
<tbody>
<tr>
<td>A score size <br> <em>(score 4 bytes + id 18 bytes + epoch time 4 bytes)</em></td>
<td>26 bytes</td>
</tr>
<tr>
<td>500 features of float</td>
<td>2,000 bytes</td>
</tr>
<tr>
<td>Avg txn per month</td>
<td>50 records</td>
</tr>
<tr>
<td>Total account</td>
<td>100 M</td>
</tr>
<tr>
<td>Retention period</td>
<td>13 months</td>
</tr>
<tr>
<td>Total Raw</td>
<td>137  TB</td>
</tr>
<tr>
<td><strong>Total Parquet size (ZSTD)</strong></td>
<td><strong>27  TB</strong></td>
</tr>
</tbody>
</table>
<p>TODO: Update how we do AC risk score
For now, account risk score maybe derived from txn risk score, so the txn score is its feature.</p>
<table>
<thead>
<tr>
<th>Account risk score</th>
<th>Estimated value</th>
</tr>
</thead>
<tbody>
<tr>
<td>A score size <br> <em>(score 4 bytes + id 18 bytes + epoch time 4 bytes)</em></td>
<td>26 bytes</td>
</tr>
<tr>
<td>Total account</td>
<td>100 M</td>
</tr>
<tr>
<td>Retention period</td>
<td>13 months</td>
</tr>
<tr>
<td>Total Raw</td>
<td>6.17  TB</td>
</tr>
<tr>
<td><strong>Total Parquet size (ZSTD)</strong></td>
<td><strong>1  TB</strong></td>
</tr>
</tbody>
</table>
<hr />
<p><strong>ML model repository</strong><br />
XGBoost model is very small. It does not require much space.</p>
<table>
<thead>
<tr>
<th>Account risk score</th>
<th>Estimated value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Max model size</td>
<td>10 MB</td>
</tr>
<tr>
<td>Max trained model per month</td>
<td>8 models</td>
</tr>
<tr>
<td>Retention period</td>
<td>24 months</td>
</tr>
<tr>
<td>Total JSON</td>
<td>2 GB</td>
</tr>
<tr>
<td><strong>Total Parquet size (ZSTD)</strong></td>
<td><strong>400 MB</strong></td>
</tr>
</tbody>
</table>
<p><strong>Master data</strong><br />
There will be some small set of master data used, e.g., Bank Account info.<br />
Let's spare <strong>1 GB</strong> for this.</p>
<p><strong>Backup Storage</strong><br />
We may need to periodical backup Redis data for 2 versions.
| Redis data | Estimated value |
|---|---|
| Account Proxy | 150 GB |
| Prediction Feature | 200 GB |
| Total Raw x2 | 700 GB |
| <strong>Total Parquet size (ZSTD)</strong> | <strong>140 GB</strong> |</p>
<p><strong>Playground Storage</strong>
60 TB</p>
<hr />
<h1 id="config">Config</h1>
<ul>
<li>Total storage: 192 TB</li>
<li>Parity disk: 3</li>
<li>Usable storage: 120 TB</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js"></script>
        <script src="../../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
